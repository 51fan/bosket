{"version":3,"sources":["../../../src/react/components/RootNode.js"],"names":["React","withListener","withLabels","tree","RootNode","defaults","ItemTreeNode","ItemTreeBaseClass","props","state","search","filtered","_state","get","set","setState","s","_props","Object","assign","onSearch","input","evt","target","value","trim","model","category","treeFilter","rootNode","onSelect","onDrag","dragndrop","drag","onDrop","drop","_unmounted","forceUpdate","keyDownListener","subscribe","onKey","keyUpListener","sort","rest","searchBar","mixCss","labels","wrapDragNDrop","PureComponent","ItemTree","eventType","propName","autoMount","reduce","accu","trait"],"mappings":"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","file":"RootNode.js","sourcesContent":["import React from \"react\"\nimport { withListener, withLabels } from \"../traits\"\nimport { tree } from \"../../tools/trees\"\nimport { RootNode, defaults } from \"../../core\"\nimport { ItemTreeNode } from \"./TreeNode\"\n\n/* Root component */\n\nclass ItemTreeBaseClass extends React.PureComponent {\n\n    /* Data & lifecycle */\n\n    state = {\n        search: \"\",\n        filtered: null\n    }\n    _state = {\n        get: () => this.state,\n        set:  s => this.setState(s)\n    }\n    _props = {\n        get: () => Object.assign({}, { ...defaults }, this.props)\n    }\n\n    constructor(props) {\n        super(props)\n        this.rootNode = new RootNode(\n            this._props,\n            {\n                onSelect:   this.props.onSelect,\n                onDrag:     this.props.dragndrop.drag || (() => {}),\n                onDrop:     this.props.dragndrop.drop\n            },\n            this._state,\n            () => { if(!this._unmounted) this.forceUpdate() }\n        )\n        if(props.keyDownListener) props.keyDownListener.subscribe(this.rootNode.onKey)\n        if(props.keyUpListener) props.keyUpListener.subscribe(this.rootNode.onKey)\n    }\n\n    /* Events */\n\n    onSearch = evt => {\n        const input = evt.target.value\n        this.setState({\n            search: input,\n            filtered: !input.trim() ?\n                null :\n                tree(this.props.model, this.props.category)\n                    .treeFilter(this.props.search(input.trim()))\n        })\n    }\n\n    /* Rendering */\n\n    render() {\n        const { sort, ...rest } = this._props.get()\n\n        const searchBar = !this.props.search ? null :\n                <input type=\"search\" className={ this.rootNode.mixCss(\"search\") }\n                    value={ this.state.search }\n                    placeholder={ this.props.labels[\"search.placeholder\"] }\n                    onChange={ this.onSearch } />\n\n        return (\n            <div className={ this.rootNode.mixCss(\"ItemTree\") }>\n                { searchBar }\n                <ItemTreeNode\n                    { ...rest }\n                    model={ sort ? this.props.model.sort(sort) : this.props.model }\n                    filteredModel={ this.state.filtered }\n                    onSelect={ this.rootNode.onSelect }\n                    dragndrop={ this.rootNode.wrapDragNDrop() }\n                    ancestors={ [] }\n                    sort={ sort }\n                    searched={ this.state.search.trim() }>\n                </ItemTreeNode>\n            </div>\n        )\n    }\n}\nexport const ItemTree = [\n    withLabels(defaults.labels),\n    withListener({ eventType: \"keydown\", propName: \"keyDownListener\", autoMount: true }),\n    withListener({ eventType: \"keyup\", propName: \"keyUpListener\", autoMount: true })\n].reduce((accu, trait) => trait(accu), ItemTreeBaseClass)\n\n"]}